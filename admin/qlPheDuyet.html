<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quyển Lịch</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f4f4f4;
            height: 100vh;
        }

        header {
            background-color: white;
            width: 100%;
            height: 10%;
            padding: 0px 20px;
            display: flex;
            justify-content: space-between;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo {
            height: 100%;
            width: auto;
            padding-right: 15px;
        }

        .menu {
            height: 100%;
            align-items: center;
        }

        .right-container {
            display: flex;
            align-items: center;
        }

        .icon-container {
            width: 40px;
            height: 40px;
            background-color: #e0e0e0;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            margin-left: 20px;
            align-items: center;
            cursor: pointer;
        }

        .dropdown-menu {
            position: absolute;
            top: 60px;
            right: 20px;
            background-color: white;
            width: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
        }

        .dropdown-menu.active {
            display: block;
        }

        .dropdown-menu li {
            list-style: none;
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
        }

        .dropdown-menu li:last-child {
            border-bottom: none;
        }

        .dropdown-menu li:hover {
            background-color: #f0f0f0;
        }

        .left-container {
            display: flex;
            align-items: center;
        }

        .left-container div {
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .left-container div:hover {
            background-color: #7ad3ff;
        }

        .container {
            max-width: 1000px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .thongTin {
            max-width: 1000px;
            margin: auto;
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        /* Thống kê */
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .stat-item {
            flex: 1;
            padding: 15px;
            text-align: center;
            color: white;
            border-radius: 8px;
            margin: 5px;
        }

        .stat-item i {
            font-size: 24px;
            display: block;
            margin-bottom: 5px;
        }

        .yellow {
            background: #f4b400;
        }

        .blue {
            background: #4285f4;
        }

        .green {
            background: #34a853;
        }

        /* Danh sách nghỉ phép */
        .leave-list h2 {
            margin-bottom: 15px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 10px;
        }

        .tab {
            padding: 10px;
            border: none;
            background: none;
            cursor: pointer;
            margin-right: 10px;
        }

        .tab.active {
            font-weight: bold;
            color: #4285f4;
            border-bottom: 2px solid #4285f4;
        }

        .tab1 {
            padding: 10px;
            border: none;
            background: none;
            cursor: pointer;
            margin-right: 10px;
        }

        .tab1.active {
            font-weight: bold;
            color: #4285f4;
            border-bottom: 2px solid #4285f4;
        }

        .tab2 {
            padding: 10px;
            border: none;
            background: none;
            cursor: pointer;
            margin-right: 10px;
        }

        .tab2.active {
            font-weight: bold;
            color: #4285f4;
            border-bottom: 2px solid #4285f4;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }

        .status {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            color: white;
        }

        .waiting {
            background: #f4b400;
        }
    </style>
</head>

<body>
    <header>
        <div class="left-container">
            <a href="index.html" class="logo"><img src="j97.jpg" class="logo"></a>
            <div><a href="index.html" style="text-decoration: none; color: #000;">Quản lí lịch làm việc</a></div>
            <div><a href="qlNhanVien.html" style="text-decoration: none; color: #000;">Quản lí nhân viên</a></div>
            <div><a href="qlPheDuyet.html" style="text-decoration: none; color: #000;">Thông tin phê duyệt</a></div>
        </div>
        <div class="right-container">
            <div class="icon-container" id="menuButton">
                &#128100;
            </div>
            <ul class="dropdown-menu" id="menuDropdown">
                <li><a href="thietLapQuyDinh.html" style="text-decoration: none; color: #000;">Thiết lập quy định</a></li>
                <li><a onclick="logout()" style="color: red;">Đăng xuất</a></li>
            </ul>
        </div>
    </header>

    <div class="container">
        <div class="stats">
            <div class="stat-item green">
                <i class="fa-solid fa-clock"></i>
                <span>Tăng ca chờ duyệt</span>
            </div>
            <div class="stat-item blue">
                <i class="fa-solid fa-clock"></i>
                <span>Quên check-out chờ duyệt</span>
            </div>
            <div class="stat-item yellow">
                <i class="fa-solid fa-users"></i>
                <span>Nghỉ phép chờ duyệt</span>
            </div>
        </div>
    </div>

    <div class="thongTin">
        <h2>Danh sách tăng ca chờ duyệt</h2>
        <hr style=" border: 1px solid #ddd; margin-top: 20px;">
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="fetchDangKyTangCaCD()">Chờ duyệt</button>
            <button class="tab" onclick="fetchDangKyTangCaDD()">Đã duyệt</button>
            <button class="tab" onclick="fetchDangKyTangCaTC()">Từ chối</button>
        </div>

        <!-- Bảng dữ liệu -->
        <table>
            <thead>
                <tr>
                    <th>Ngày tăng ca</th>
                    <th>Trạng thái</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="tangCaTable"></tbody>
        </table>
    </div>

    <div class="thongTin">
        <h2>Danh sách quên check-out chờ duyệt</h2>
        <hr style=" border: 1px solid #ddd; margin-top: 20px;">
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab1 active" onclick="fetchQuenCheckOutCD()">Chờ duyệt</button>
            <button class="tab1" onclick="fetchQuenCheckOutDD()">Đã duyệt</button>
            <button class="tab1" onclick="fetchQuenCheckOutTC()">Từ chối</button>
        </div>

        <!-- Bảng dữ liệu -->
        <table>
            <thead>
                <tr>
                    <th>Ngày quên</th>
                    <th>Lí do</th>
                    <th>Trạng thái</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="quenCheckOutTable"></tbody>
        </table>
    </div>

    <div class="thongTin">
        <h2>Danh sách nghỉ phép chờ duyệt</h2>
        <hr style=" border: 1px solid #ddd; margin-top: 20px;">
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab2 active" onclick="fetchNghiPhepCD()">Chờ duyệt</button>
            <button class="tab2" onclick="fetchNghiPhepDD()">Đã duyệt</button>
            <button class="tab2" onclick="fetchNghiPhepTC()">Từ chối</button>
        </div>

        <!-- Bảng dữ liệu -->
        <table>
            <thead>
                <tr>
                    <th>Ngày nghỉ phép</th>
                    <th>Lí do</th>
                    <th>Trạng thái</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="nghiPhepTable"></tbody>
        </table>
    </div>

    <script>
        const menuButton = document.getElementById('menuButton');
        const menuDropdown = document.getElementById('menuDropdown');

        menuButton.addEventListener('click', () => {
            menuDropdown.classList.toggle('active');
        });

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function () {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        document.querySelectorAll('.tab1').forEach(tab => {
            tab.addEventListener('click', function () {
                document.querySelectorAll('.tab1').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        document.querySelectorAll('.tab2').forEach(tab => {
            tab.addEventListener('click', function () {
                document.querySelectorAll('.tab2').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        async function fetchDangKyTangCaCD() {
            const token = localStorage.getItem("token");

            try {
                const response = await fetch("https://localhost:7219/api/NhanVien/ChoDuyetDKTangCa", {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) {
                    throw new Error("Không tìm thấy dữ liệu.");
                }

                const data = await response.json();
                const tableBody = document.getElementById("tangCaTable");
                tableBody.innerHTML = ""; // Xóa dữ liệu cũ

                data.forEach(item => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td class="ngayLam">${new Date(item.ngayChamCong).toLocaleDateString()}</td>
                    <td>${item.tinhTrang}</td>
                    <td style="color:red; cursor:pointer;" onclick="huyDangKyTangCa('${item.ngayChamCong}')">Hủy</td>
                `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Lỗi khi lấy dữ liệu:", error);
                document.getElementById("tangCaTable").innerHTML = "<tr><td colspan='2'>Không có dữ liệu</td></tr>";
            }
        }

        async function fetchDangKyTangCaDD() {
            const token = localStorage.getItem("token");

            try {
                const response = await fetch("https://localhost:7219/api/NhanVien/DaDuyetDKTangCa", {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) {
                    throw new Error("Không tìm thấy dữ liệu.");
                }

                const data = await response.json();
                const tableBody = document.getElementById("tangCaTable");
                tableBody.innerHTML = ""; // Xóa dữ liệu cũ

                data.forEach(item => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td class="ngayLam">${new Date(item.ngayChamCong).toLocaleDateString()}</td>
                    <td>${item.tinhTrang}</td>
                `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Lỗi khi lấy dữ liệu:", error);
                document.getElementById("tangCaTable").innerHTML = "<tr><td colspan='2'>Không có dữ liệu</td></tr>";
            }
        }

        async function fetchDangKyTangCaTC() {
            const token = localStorage.getItem("token");

            try {
                const response = await fetch("https://localhost:7219/api/NhanVien/TuChoiDKTangCa", {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) {
                    throw new Error("Không tìm thấy dữ liệu.");
                }

                const data = await response.json();
                const tableBody = document.getElementById("tangCaTable");
                tableBody.innerHTML = ""; // Xóa dữ liệu cũ

                data.forEach(item => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td class="ngayLam">${new Date(item.ngayChamCong).toLocaleDateString()}</td>
                    <td>${item.tinhTrang}</td>
                `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Lỗi khi lấy dữ liệu:", error);
                document.getElementById("tangCaTable").innerHTML = "<tr><td colspan='2'>Không có dữ liệu</td></tr>";
            }
        }

        async function huyDangKyTangCa(ngayLam) {
            if (!confirm("Bạn có chắc chắn muốn hủy đăng ký tăng ca này không?")) {
                return;
            }
            const token = localStorage.getItem("token");
            try {
                const response = await fetch(`https://localhost:7219/api/NhanVien/XoaDKTangCa?ngayLam=${ngayLam}`, {
                    method: "DELETE",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });

                const message = await response.text();

                if (!response.ok) {
                    throw new Error(message);
                }

                alert(message); // Hiển thị thông báo thành công
                fetchDangKyTangCaCD();

            } catch (error) {
                alert("Lỗi: " + error.message);
                console.error("Lỗi:", error);
            }
        }

        async function fetchQuenCheckOutCD() {
            const token = localStorage.getItem("token");

            try {
                const response = await fetch(`https://localhost:7219/api/NhanVien/ChoDuyetQuenCO`, {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) {
                    throw new Error("Không tìm thấy dữ liệu.");
                }

                const data = await response.json();
                const tableBody = document.getElementById("quenCheckOutTable");
                tableBody.innerHTML = ""; // Xóa dữ liệu cũ

                data.forEach(item => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td class="ngayLam">${new Date(item.ngayChamCong).toLocaleDateString()}</td>
                    <td>${item.liDo}</td>
                    <td>${item.tinhTrang}</td>
                    <td style="color:red; cursor:pointer;" onclick="huyQuenCheckOut('${item.ngayChamCong}')">Hủy</td>
                `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Lỗi khi lấy dữ liệu:", error);
                document.getElementById("quenCheckOutTable").innerHTML = "<tr><td colspan='3'>Không có dữ liệu</td></tr>";
            }
        }

        async function fetchQuenCheckOutDD() {
            const token = localStorage.getItem("token");

            try {
                const response = await fetch(`https://localhost:7219/api/NhanVien/DaDuyetQuenCO`, {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) {
                    throw new Error("Không tìm thấy dữ liệu.");
                }

                const data = await response.json();
                const tableBody = document.getElementById("quenCheckOutTable");
                tableBody.innerHTML = ""; // Xóa dữ liệu cũ

                data.forEach(item => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td class="ngayLam">${new Date(item.ngayChamCong).toLocaleDateString()}</td>
                    <td>${item.liDo}</td>
                    <td>${item.tinhTrang}</td>
                `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Lỗi khi lấy dữ liệu:", error);
                document.getElementById("quenCheckOutTable").innerHTML = "<tr><td colspan='3'>Không có dữ liệu</td></tr>";
            }
        }

        async function fetchQuenCheckOutTC() {
            const token = localStorage.getItem("token");

            try {
                const response = await fetch(`https://localhost:7219/api/NhanVien/TuChoiQuenCO`, {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) {
                    throw new Error("Không tìm thấy dữ liệu.");
                }

                const data = await response.json();
                const tableBody = document.getElementById("quenCheckOutTable");
                tableBody.innerHTML = ""; // Xóa dữ liệu cũ

                data.forEach(item => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td class="ngayLam">${new Date(item.ngayChamCong).toLocaleDateString()}</td>
                    <td>${item.liDo}</td>
                    <td>${item.tinhTrang}</td>
                `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Lỗi khi lấy dữ liệu:", error);
                document.getElementById("quenCheckOutTable").innerHTML = "<tr><td colspan='3'>Không có dữ liệu</td></tr>";
            }
        }

        async function huyQuenCheckOut(ngayLam) {
            if (!confirm("Bạn có chắc chắn muốn hủy quên check-out này không?")) {
                return;
            }
            const token = localStorage.getItem("token");

            try {
                const response = await fetch(`https://localhost:7219/api/NhanVien/XoaQuenCO?ngayLam=${ngayLam}`, {
                    method: "DELETE",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });

                const message = await response.text();

                if (!response.ok) {
                    throw new Error(message);
                }

                alert(message); // Hiển thị thông báo thành công
                fetchQuenCheckOutCD();

            } catch (error) {
                alert("Lỗi: " + error.message);
                console.error("Lỗi:", error);
            }
        }

        async function fetchNghiPhepCD() {
            const token = localStorage.getItem("token");

            try {
                const response = await fetch(`https://localhost:7219/api/NhanVien/ChoDuyetNghiPhep`,{
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) {
                    throw new Error("Không tìm thấy dữ liệu.");
                }

                const data = await response.json();
                const tableBody = document.getElementById("nghiPhepTable");
                tableBody.innerHTML = ""; // Xóa dữ liệu cũ

                data.forEach(item => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td class="ngayLam">${new Date(item.ngayChamCong).toLocaleDateString()}</td>
                    <td>${item.liDo}</td>
                    <td>${item.tinhTrang}</td>
                    <td style="color:red; cursor:pointer;" onclick="huyNghiPhep('${item.ngayChamCong}')">Hủy</td>
                `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Lỗi khi lấy dữ liệu:", error);
                document.getElementById("nghiPhepTable").innerHTML = "<tr><td colspan='3'>Không có dữ liệu</td></tr>";
            }
        }

        async function fetchNghiPhepDD() {
            const token = localStorage.getItem("token");

            try {
                const response = await fetch(`https://localhost:7219/api/NhanVien/DaDuyetNghiPhep`,{
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) {
                    throw new Error("Không tìm thấy dữ liệu.");
                }

                const data = await response.json();
                const tableBody = document.getElementById("nghiPhepTable");
                tableBody.innerHTML = ""; // Xóa dữ liệu cũ

                data.forEach(item => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td class="ngayLam">${new Date(item.ngayChamCong).toLocaleDateString()}</td>
                    <td>${item.liDo}</td>
                    <td>${item.tinhTrang}</td>
                `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Lỗi khi lấy dữ liệu:", error);
                document.getElementById("nghiPhepTable").innerHTML = "<tr><td colspan='3'>Không có dữ liệu</td></tr>";
            }
        }

        async function fetchNghiPhepTC() {
            const token = localStorage.getItem("token");

            try {
                const response = await fetch(`https://localhost:7219/api/NhanVien/TuChoiNghiPhep`,{
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) {
                    throw new Error("Không tìm thấy dữ liệu.");
                }

                const data = await response.json();
                const tableBody = document.getElementById("nghiPhepTable");
                tableBody.innerHTML = ""; // Xóa dữ liệu cũ

                data.forEach(item => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td class="ngayLam">${new Date(item.ngayChamCong).toLocaleDateString()}</td>
                    <td>${item.liDo}</td>
                    <td>${item.tinhTrang}</td>
                `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Lỗi khi lấy dữ liệu:", error);
                document.getElementById("nghiPhepTable").innerHTML = "<tr><td colspan='3'>Không có dữ liệu</td></tr>";
            }
        }

        async function huyNghiPhep(ngayLam) {
            if (!confirm("Bạn có chắc chắn muốn hủy nghỉ phép này không?")) {
                return;
            }
            const token = localStorage.getItem("token");

            try {
                const response = await fetch(`https://localhost:7219/api/NhanVien/XoaNghiPhep?ngayLam=${ngayLam}`, {
                    method: "DELETE",
                    headers: {
                        "Authorization": `Bearer ${token}`, // Đính kèm token trong header
                        "Content-Type": "application/json"
                    }
                });

                const message = await response.text();

                if (!response.ok) {
                    throw new Error(message);
                }

                alert(message); // Hiển thị thông báo thành công
                fetchNghiPhepCD();

            } catch (error) {
                alert("Lỗi: " + error.message);
                console.error("Lỗi:", error);
            }
        }
        fetchQuenCheckOutCD();
        fetchDangKyTangCaCD();
        fetchNghiPhepCD();
    </script>
</body>